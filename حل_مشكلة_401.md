# ๐ง ุญู ูุดููุฉ 401 Unauthorized ูู Notifications

## โ ุชู ุฅุตูุงุญ ุงููุดููุฉ!

### ๐ ูุง ูุงูุช ุงููุดููุฉุ

ูุงูุช ุงููุดููุฉ ูู ุฃู ูุธุงู ุงูู refresh tokens ูู ููู ูุทุจูุงู ุจุดูู ุตุญูุญ:
- ุงูู Backend ูุงู ูุฑุณู tokens ููููุฉ (`mock-refresh-token`)
- ูู ููู ููุงู ุฌุฏูู ูุชุฎุฒูู refresh tokens ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุนูุฏ ูุญุงููุฉ ุชุญุฏูุซ ุงูู tokenุ ูุงู ููุดู ููุนุทู ุฎุทุฃ 401

### โจ ูุง ุชู ุฅุตูุงุญูุ

1. โ ุฃุถูุช ุฌุฏูู `RefreshToken` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. โ ุฃุถูุช ุญูู `tokenVersion` ูุฌุฏูู ุงููุณุชุฎุฏููู
3. โ ุญุฏุซุช AuthService ูุชุฎุฒูู tokens ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุญุฏุซุช refresh token endpoint ููุนูู ุจุดูู ุตุญูุญ
5. โ ุฃูุดุฃุช ููู SQL ูุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ ููู ุงูุขู

### 1๏ธโฃ ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
npm run db:start
```

### 2๏ธโฃ ุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงุฎุชุฑ ุฅุญุฏู ุงูุทุฑููุชูู:**

**ุงูุทุฑููุฉ ุงูุฃููู (ุงูุฃุณูู):**
```bash
npx prisma migrate dev --name add_refresh_token
```

**ุงูุทุฑููุฉ ุงูุซุงููุฉ (ุฅุฐุง ูู ุชูุฌุญ ุงูุฃููู):**
```bash
# ุงูุชุญ psql
psql -U postgres -d smart_campus_dev

# ููุฐ ุงูุฃูุฑ ุงูุชุงูู ุฏุงุฎู psql
\i prisma/migrations/manual_migration_refresh_token.sql
```

### 3๏ธโฃ ุฅุนุงุฏุฉ ุชุดุบูู ุงูู Backend

```bash
npm run server:dev
```

### 4๏ธโฃ ูุณุญ ุงูู tokens ุงููุฏููุฉ ูู ุงููุชุตูุญ

ุงูุชุญ Developer Console ูู ุงููุชุตูุญ (F12) ูุงูุชุจ:
```javascript
localStorage.clear();
location.reload();
```

### 5๏ธโฃ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู

ุณุฌู ุฏุฎูู ูู ุฌุฏูุฏ ูุณุชุนูู ุงูู notifications ุจุฏูู ุฃุฎุทุงุก 401!

## ๐ ุงููููุงุช ุงูุชู ุชู ุชุนุฏูููุง

1. `prisma/schema.prisma` - ุฅุถุงูุฉ ูููุฐุฌ RefreshToken ูุญูู tokenVersion
2. `src/services/auth.service.ts` - ุชุญุฏูุซ ููุทู refresh tokens
3. `prisma/migrations/manual_migration_refresh_token.sql` - ููู SQL ููุชุทุจูู ุงููุฏูู
4. Prisma Client - ุชู ุชูููุฏู ุจูุฌุงุญ

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุฎุทูุงุช:
- โ ูู ุชุฑู ุฃุฎุทุงุก 401 ูู ุงูู notifications
- โ ุณูุชู ุชุญุฏูุซ ุงูู access token ุชููุงุฆูุงู ุนูุฏ ุงูุชูุงุก ุตูุงุญูุชู
- โ ุณุชุนูู ุฌููุน ุงูู API endpoints ุจุดูู ุทุจูุนู
- โ ุณุชุจูู ูุณุฌู ุฏุฎูู ุญุชู ุจุนุฏ ุฅุบูุงู ุงููุชุตูุญ (7 ุฃูุงู)

## โ๏ธ ููุงุญุธุงุช ูููุฉ

- ุฌููุน ุงููุณุชุฎุฏููู ูุญุชุงุฌูู ุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ ุจุนุฏ ูุฐุง ุงูุชุญุฏูุซ
- ุงูู tokens ุงููุฏููุฉ ูู ุชุนูู ุจุนุฏ ุงูุขู
- ุชุฃูุฏ ูู ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุชุดุบูู ุงูู Backend

## ๐ ูููุฒูุฏ ูู ุงูุชูุงุตูู

ุฑุงุฌุน ููู `REFRESH_TOKEN_FIX.md` ููุชูุงุตูู ุงููููุฉ ุงููุงููุฉ

---

**ุงูุญุงูุฉ**: โ ุงูููุฏ ุฌุงูุฒ - ูุญุชุงุฌ ููุท ุชุทุจูู Migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

